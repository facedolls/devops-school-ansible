- name: Users create
  become: yes
  gather_facts: false
  hosts: nodes

  vars:
    users:
      - user: Alice
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31393634386137326534383139616535616438636164653863393439383936653835633130613439
          3136623762393763363435303366366162656233333563370a366133393835366566633662623935
          35326461303731343762623436613132666630303866323835383339323061303235653137343239
          6232646665343266620a356663643536613139633536636662326431653131326438313566623239
          30643665343162633462316562666636356433656232313465313834323533653834

      - user: Bob
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64343066383462386235343737396133313737613532326566633866643933383939396335613231
          3435333165373463663639626332346531643338346434640a323161333533653234313038623832
          30363934303732636164333536363637346664376238313533656263323036623566646139623761
          6334303935383966650a643963353765663238333165666565343538383265633963313532373236
          37623438663536363435313164303839386261333633353064663234343336393834

      - user: Carol
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39346461643938623637366536396138623261383564613061356530333230373032336632303339
          3563343138633630623236393731383366353033663064640a636138636363383632633738386234
          35666637353963376535653231383632313332366638323266613338356565326461323765333530
          6532656165323633320a353937646139313239386431643862346564623131633662663962663533
          39383265323564653566623935643833376263303561313035396535323661306333

  tasks:
    - name: Users create
      loop: "{{ users }}"
      user:
        name: "{{ item.user }}"
        comment: "{{ item.user }}@example.com"
        home: "/home/{{ item.user }}"
        password: "{{ item.password | password_hash('sha512')}}"
        update_password: on_create
